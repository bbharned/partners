<style>
@media print and (min-width:100px) {.ra-top-bar, .ff-instructions, #footer, #disclaimer, #control-buttons {display:none !important;}}
</style>
<div class="container" style="padding-bottom: 150px; margin:auto;">
<div class="row">
	<div class="col-md-8">
		<h1>Flex Forward Calculator</h1>
	</div>
	<div class="col-md-4 ff-top-logo">
		<%= image_tag "ff-logo.png" %>
	</div>
</div>
<hr />
<div class="ff-instructions">
<p>Flex Forward is an elective commercial initiative that provides customers a path forward to the V-FLEX licensing model from legacy 5/10/25-pack, Enterprise Server, and Enterprise Site licensing models.</p> 

<div class="row">
<div class="col-md-8">
<p>In order to execute the program, the following information will be important to understand:</p>
<ul style="margin-top: -15px; margin-bottom: 20px;">
	<li>Which locations/sites are interested in participating in the program</li>
	<li>Existing licensing at each site including Product License numbers</li>
	<li>Number of desired terminals at each site (for Enterprise Site/Server customers)</li>
	<li>Support status of each license (current, or what date expired)</li>
</ul>
</div>
<div class="col-md-4" align="center">
	<div class="ff-datasheet">
		<h5>Flex Forward Datasheet</h5>
		
		<% if @current_user.channel == "Rockwell Automation" %>
			<%= link_to image_tag("icon_pdf_large.png"), "https://thinmanager.com/vflex/images/FlexForward-RA_Datasheet.pdf", target: "_blank" %>
		<% elsif @current_user.channel != "Rockwell Automation" %>
			<%= link_to image_tag("icon_pdf_large.png"), "https://thinmanager.com/vflex/images/FlexForward-TM_Datasheet.pdf", target: "_blank" %>
		<% end %>
		
	</div>
</div>
</div>
<p class="appear">&nbsp;</p>

<p>Once this information is collected, your ThinManager Strategic Account Manager can assist with generating a quote. 
To identify your representative, please visit <%= link_to "https://thinmanager.com/corp/contactus.php", "https://thinmanager.com/corp/contactus.php", target: "_blank" %>.</p>
</div>


<%= render 'form' %>


</div>

<script>
    (function(){

        $('body').on('keydown', 'input, select', function(e) {
            if (e.key === "Enter") {
                var self = $(this), form = self.parents('form:eq(0)'), focusable, next;
                focusable = form.find('input,a,select,button,textarea').filter(':visible');
                next = focusable.eq(focusable.index(this)+1);
                if (next.length) {
                    next.focus();
                } else {
                    form.submit();
                }
                return false;
            }
        });
 })();
</script>


<script>
    (function(){

        // $('body').on('keydown', 'input, select', function(e) {
        //     if (e.key === "Enter") {
        //         var self = $(this), form = self.parents('form:eq(0)'), focusable, next;
        //         focusable = form.find('input,a,select,button,textarea').filter(':visible');
        //         next = focusable.eq(focusable.index(this)+1);
        //         if (next.length) {
        //             next.focus();
        //         } else {
        //             form.submit();
        //         }
        //         return false;
        //     }
        // });

        // "use strict";

        // quote expiration date
        // var expDate = new Date();
        // var dd = String(expDate.getDate()).padStart(2, '0');
        // var mm = String(expDate.getMonth() + 1).padStart(2, '0'); //January is 0!
        // var yyyy = expDate.getFullYear() + 1;
        // expDate = mm + '/' + dd + '/' + yyyy;
        // add if statement in case of edit
        //if $('#field37').text == " " {
        //$('#field37').val(expDate);
        //}

        // function setCurrencies(id) {
        // 	var currencies;
        // 	currencies.push(id);
        // 	return currencies;
        // };
        

        $('input').on('change', function() {

        	
            //V-Flex Prices
            // var vfRedPrices = [3400, 1870, 1700, 1360, 1190, 1020];
            // var smrPrices = [400, 220, 200, 160, 140, 120];
            // var vfNonRedPrices = [2400, 1320, 1200, 960, 840, 720];

            // var field1 = $("#field1").val();
            // var field2 = $("#field2").val();
            // var field3 = $("#field3").val();
            // var field4 = $("#field4").val();
            // var field5 = $("#field5").val();
            // var field6 = $("#field6").val();
            // var field7 = $("#field7").val();
            // var field8 = $("#field8").val();
            // var field9 = $("#field9").val();
            // var field10 = $("#field10").val();
            // var field11 = $("#field11").val();
            // var field12 = $("#field12").val();
            // var field13 = $("#field13").val();
            // var field14 = $("#field14").val();
            // var field17 = $("#field17").val();
            // var field18 = $("#field18").val();

            // field1 = Number(field1);
            // field2 = Number(field2);
            // field3 = Number(field3);
            // field4 = Number(field4);
            // field5 = Number(field5);
            // field6 = Number(field6);
            // field7 = Number(field7);
            // field8 = Number(field8);
            // field9 = Number(field9);
            // field10 = Number(field10);
            // field11 = Number(field11);
            // field12 = Number(field12);
            // field13 = Number(field13);
            // field14 = Number(field14);
            // field17 = Number(field17);
            // field18 = Number(field18);


            // function currencyFormat(num) {
            //   return '$' + num.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
            // }

            // var field15 = field3 + field7;
            // var field16 = field4 + field8; 

            // var field20 = 600 * field13;
            // //currency here?
            // $("#field20").val(field20.toFixed(2));
            

            // var field21 = 600 * field14;
            // //currency here?
            // $("#field21").val(field21.toFixed(2));
            
            
            //var totalTerms = Number(field13) + Number(field14) + Number(field15) + Number(field16) + Number(field17) + Number(field18);
            
            // $("#field15").val(field15);
            // $("#field16").val(field16);
            // $("#field19").val(totalTerms);
            // if (totalTerms >= 0) {
            //     $("#field36").val(totalTerms);
            // }

            // function findRange(terminalCount) {
            //     var terminalRange;
            //     if (terminalCount >= 0 && terminalCount < 5) {
            //         var terminalRange = 0;  
            //     } else if (terminalCount >=5 && terminalCount < 50) {
            //         var terminalRange = 1;
            //     } else if (terminalCount >=50 && terminalCount < 100) {
            //         var terminalRange = 2;
            //     } else if (terminalCount >=100 && terminalCount < 250) {
            //         var terminalRange = 3;
            //     } else if (terminalCount >=250 && terminalCount < 500) {
            //         var terminalRange = 4;
            //     } else if (terminalCount >=500) {
            //         var terminalRange = 5;
            //     }
            //     return terminalRange;
            // }
            
            var currentRange = findRange(totalTerms);
            var tradePackRange = findRange(field15);
            var tradeRPackRange = findRange(field16);

            var simplexPricePer = vfNonRedPrices[currentRange];
            var redundPricePer = vfRedPrices[currentRange];
            var tradeSimplexPricePer = vfNonRedPrices[tradePackRange];
            var tradeRedPricePer = vfRedPrices[tradeRPackRange];

            var totalNewSimplexCost = simplexPricePer * field17;
            var field24 = totalNewSimplexCost;
            if (field24 > 0) {
                //currency here?
                $("#field24").val(field24.toFixed(2));
            } else {
                $("#field24").val(0);
            }
            
            var totalNewRedCost = redundPricePer * field18;
            var field25 = totalNewRedCost;
            if (field25 > 0) {
                //currency here?
                $("#field25").val(field25.toFixed(2));
            } else {
                $("#field25").val(0);
            }

            var totalTradeSimplex = tradeSimplexPricePer * field15;
            var totalTradeRed = tradeRedPricePer * field16;

            if (totalTradeSimplex > 0) {
                var field22 = totalTradeSimplex;
            } else {
                var field22 = 0;
            };
            //currency here?
            $("#field22").val(field22.toFixed(2));
            

            if (totalTradeRed > 0) {
                var field23 = totalTradeRed;
            } else {
                var field23 = 0;
            };
            //currency here?
            $("#field23").val(field23.toFixed(2));

            var totalTradeUpPricing = field20 + field21 + field22 + field23 + field24 + field25;

            var field26 = totalTradeUpPricing;
            if (field26 > 0) {
                //currency here?
                $("#field26").val(field26.toFixed(2));
            } else {
                $("#field26").val(0);
            };
            
            
            // Credit Calculations *****************************************

            var field27;
            var field28;
            var field29;
            var field30;
            var field31;
            var field32;
            var field33;
            var field34;
            var field35;
            var field38;


            var creditForServerLicensesWithSupport = 61150 * field1;
            var creditForServerLicensesNoSupport = (1-(0.2*field9))*(field5*61150);
            if (creditForServerLicensesNoSupport < 0) {
                creditForServerLicensesNoSupport = 0;
            }
            var totalCreditsServer = creditForServerLicensesWithSupport + creditForServerLicensesNoSupport // No negative
            if (totalCreditsServer < 0) {
                totalCreditsServer = 0;
            };

            if (totalCreditsServer > field20) {
                $("#field27").val(field20.toFixed(2));
                field27 = field20;
            } else {
                //currency here?
                $("#field27").val(totalCreditsServer.toFixed(2));
                field27 = totalCreditsServer;
            };
            

            var creditForSiteLicensesWithSupport = 134000 * field2;
            var creditForSiteLicensesNoSupport = (1-(0.2*field10))*(field6*134000);
            if (creditForSiteLicensesNoSupport < 0) {
                creditForSiteLicensesNoSupport = 0;
            }
            var totalCreditsSite = creditForSiteLicensesWithSupport + creditForSiteLicensesNoSupport // No negative
            if (totalCreditsSite < 0) {
                totalCreditsSite = 0;
            };

            if (totalCreditsSite > field21) {
                $("#field28").val(field21.toFixed(2));
                field28 = field21;
            } else {
                //var totalCreditsSiteCurrency = currencyFormat(totalCreditsSite);
                $("#field28").val(totalCreditsSite.toFixed(2));
                field28 = totalCreditsSite;
            };


            var creditForPackLicensesWithSupport = field3 * tradeSimplexPricePer;
            var creditForPackLicensesNoSupport = (1-(0.2*field11))*(field7*tradeSimplexPricePer);
            if (creditForPackLicensesNoSupport < 0) {
                creditForPackLicensesNoSupport = 0;
            }
            var totalCreditsPack = creditForPackLicensesWithSupport + creditForPackLicensesNoSupport; // No negative
            if (totalCreditsPack < 0) {
                totalCreditsPack = 0;
            };

            if (totalCreditsPack > field22) {
                $("#field29").val(field22.toFixed(2));
                field29 = field22;
            } else {
                $("#field29").val(totalCreditsPack.toFixed(2));
                field29 = totalCreditsPack;
            };
            

            var creditForRPackLicensesWithSupport = field4 * tradeRedPricePer;
            var creditForRPackLicensesNoSupport = (1-(0.2*field12))*(field8*tradeRedPricePer);
            if (creditForRPackLicensesNoSupport < 0) {
                creditForRPackLicensesNoSupport = 0;
            }
            var totalCreditsRPack = creditForRPackLicensesWithSupport + creditForRPackLicensesNoSupport; // No negative
            if (totalCreditsRPack < 0) {
                totalCreditsRPack = 0;
            }

            if (totalCreditsRPack > field23) {
                $("#field30").val(field23.toFixed(2));
                field30 = field23;
            } else {
                //currency here?
                $("#field30").val(totalCreditsRPack.toFixed(2));
                field30 = totalCreditsRPack;
            };
            
            field33 = field27 + field28 + field29 + field30;
            if (field33 > 0) {
                $("#field33").val(field33.toFixed(2));
            } else {
                $("#field33").val(0);
            };

            field34 = field26 - field33;
            var field34b = currencyFormat(field34);
            $("#field34").val(field34);

            var termsForSM = field13 + field14 + field15 + field16;
            var SMRange = findRange(termsForSM);
            var smPricePer = smrPrices[currentRange]; // This is the total term range ********************
            field35 = smPricePer * termsForSM;
            var field35b = currencyFormat(field35);
            $("#field35").val(field35);


            field38 = field34 + field35;
            var field38b = currencyFormat(field38);
            $("#field38").val(field38);
        });



        $("#reset").click(function() {
            refresh();
        });


        $("#print").click(function() {
            print();
            return false;
        });

    })();
</script>